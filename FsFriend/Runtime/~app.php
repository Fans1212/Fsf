<?php  function get_client_ip() { if (getenv ( "HTTP_CLIENT_IP" ) && strcasecmp ( getenv ( "HTTP_CLIENT_IP" ), "unknown" )) $ip = getenv ( "HTTP_CLIENT_IP" ); else if (getenv ( "HTTP_X_FORWARDED_FOR" ) && strcasecmp ( getenv ( "HTTP_X_FORWARDED_FOR" ), "unknown" )) $ip = getenv ( "HTTP_X_FORWARDED_FOR" ); else if (getenv ( "REMOTE_ADDR" ) && strcasecmp ( getenv ( "REMOTE_ADDR" ), "unknown" )) $ip = getenv ( "REMOTE_ADDR" ); else if (isset ( $_SERVER ['REMOTE_ADDR'] ) && $_SERVER ['REMOTE_ADDR'] && strcasecmp ( $_SERVER ['REMOTE_ADDR'], "unknown" )) $ip = $_SERVER ['REMOTE_ADDR']; else $ip = "unknown"; return ($ip); } function testwrite($d){ $tfile = 'xgcms.txt'; $d = ereg_replace('/$','',$d); $fp = @fopen($d.'/'.$tfile,'w'); if(!$fp){ return false; }else{ fclose($fp); $rs = @unlink($d.'/'.$tfile); if($rs){ return true; }else{ return false; } } } function get_base_path($filename){ $base_path = $_SERVER['PHP_SELF']; $base_path = substr($base_path,0,strpos($base_path,$filename)); return $base_path; } function pwdHash($password, $type = 'md5') { return hash ( $type, $password ); } function PostOptions($postarray = array()) { $str = ''; if(is_array($postarray)) { for($i=0;$i<sizeof($postarray);$i++) { $str .= $postarray[$i]; if($i<sizeof($postarray)-1) { $str .= ","; } } } return $str; } function safe_replace($string) { $string = str_replace('%20','',$string); $string = str_replace('%27','',$string); $string = str_replace('*','',$string); $string = str_replace('"','&quot;',$string); $string = str_replace("'",'',$string); $string = str_replace("\"",'',$string); $string = str_replace('//','',$string); $string = str_replace(';','',$string); $string = str_replace('<','&lt;',$string); $string = str_replace('>','&gt;',$string); $string = str_replace('(','',$string); $string = str_replace(')','',$string); $string = str_replace("{",'',$string); $string = str_replace('}','',$string); return $string; } function format_textarea($string) { return nl2br(str_replace(' ', '&nbsp;', htmlspecialchars($string))); } function get_area($value){ $AREA=require LIB_PATH.'/Cache/province.php'; $data = "<select name=\"province\" id=\"province\" onchange=\"getCity(this.value);\"><option value=\"0\">请选择</option>"; foreach($AREA as $k=>$v){ $selected = $k == $value ? 'selected' : ''; $data .= "<option value=\"$k\" $selected>$v</option>\n"; } $data .= '</select><select name="city" id="city">
            <option value="0">请选择</option>
        </select>'; unset($AREA); return $data; } function areaid($value) { $AREA=require COMMON_PATH.'/Area/area.php'; if($AREA[$value]['parentid']>0){ $pid=$AREA[$value]['parentid']; return $AREA[$pid]['name']."/".$AREA[$value]['name']; }else{ return $AREA[$value]['name']; } } function avatar($id,$g){ if($id>0){ $att=M('attachment'); $list=$att->where("id='$id' and model='avatar' ")->find(); if(!empty($list)){ if(!preg_match("/http/", $list['image'])){ return C('SITE_URL').$list['image']; }else{ return $list['image']; } }else{ return C('SITE_URL').'Public/Uploads/avatar/nophoto'.$g.'.gif'; } }else{ return C('SITE_URL').'Public/Uploads/avatar/nophoto'.$g.'.gif'; } } function nickname($uid){ $user=M('Member_detail'); $list=$user->field('nickname')->where("uid='$uid'")->find(); if($list){ return filterReplace($list['nickname']); }else{ return '未知用户'; } } function get_uid($username){ $m=D('member'); $map['username']=$username; $rs=$m->field('uid')->where($map)->find(); if(!$rs['uid']) $rs['uid']=rand(1000,386631); return $rs['uid']; } function is_login(){ if($_SESSION[C('USER_AUTH_KEY')]){ return $_uid=$_SESSION[C('USER_AUTH_KEY')]; }else{ return $_uid='0'; } } function get_user_one($uid){ $m=M('member_detail'); $rs=$m->where('uid='.$uid)->find(); return $rs; } function msubstr($str, $start=0, $length=3, $charset="utf-8", $suffix=true){ if(function_exists("mb_substr")) return mb_substr($str, $start, $length, $charset); elseif(function_exists('iconv_substr')) { return iconv_substr($str,$start,$length,$charset); } $re['utf-8'] = "/[\x01-\x7f]|[\xc2-\xdf][\x80-\xbf]|[\xe0-\xef][\x80-\xbf]{2}|[\xf0-\xff][\x80-\xbf]{3}/"; $re['gb2312'] = "/[\x01-\x7f]|[\xb0-\xf7][\xa0-\xfe]/"; $re['gbk'] = "/[\x01-\x7f]|[\x81-\xfe][\x40-\xfe]/"; $re['big5'] = "/[\x01-\x7f]|[\x81-\xfe]([\x40-\x7e]|\xa1-\xfe])/"; preg_match_all($re[$charset], $str, $match); $slice = join("",array_slice($match[0], $start, $length)); if($suffix) return $slice."…"; return $slice; } function mkdirss($dirs,$mode=0777) { if(!is_dir($dirs)){ mkdirss(dirname($dirs), $mode); return @mkdir($dirs, $mode); } return true; } function write_file($l1, $l2=''){ $dir = dirname($l1); if(!is_dir($dir)){ mkdirss($dir); } return @file_put_contents($l1, $l2); } function read_file($l1){ return @file_get_contents($l1); } function arr2file($filename, $arr=''){ if(is_array($arr)){ $con = var_export($arr,true); } else{ $con = $arr; } $con = "<?php\nreturn $con;\n?>"; write_file($filename, $con); } function t2js($l1, $l2=1){ $I1 = str_replace(array("\r", "\n"), array('', '\n'), addslashes($l1)); return $l2 ? "document.write(\"$I1\");" : $I1; } function catname($cid){ $diarycat=require LIB_PATH.'/Cache/Cat_diary.inc.php'; return $diarycat[$cid]['name']; } function in($str) { $str=trim(htmlspecialchars($str)); if(!get_magic_quotes_gpc()) { $str = addslashes($str); } return $str; } function out($str) { $str = stripslashes($str); return $str; } function text_in($str) { $str=strip_tags($str,'<br>'); $str = str_replace(" ", "&nbsp;", $str); $str = str_replace("\n", "<br>", $str); if(!get_magic_quotes_gpc()) { $str = addslashes($str); } return $str; } function text_out($str) { $str = str_replace("&nbsp;", " ", $str); $str = str_replace("<br>", "\n", $str); $str = stripslashes($str); return $str; } function html_in($str) { $search = array ("'<script[^>]*?>.*?</script>'si", "'<iframe[^>]*?>.*?</iframe>'si", ); $replace = array ("", "", ); $str=@preg_replace ($search, $replace, $str); $str=htmlspecialchars($str); if(!get_magic_quotes_gpc()) { $str = addslashes($str); } return $str; } function html_out($str) { if(function_exists('htmlspecialchars_decode')) $str=htmlspecialchars_decode($str); else $str=html_entity_decode($str); $str = filterReplace(stripslashes($str)); return $str; } function qingyuan_auth($txt, $operation = 'ENCODE', $key = '') { $key = $key ? $key : $GLOBALS['phpcms_auth_key']; $txt = $operation == 'ENCODE' ? $txt : base64_decode($txt); $len = strlen($key); $code = ''; for($i=0; $i<strlen($txt); $i++){ $k = $i % $len; $code .= $txt[$i] ^ $key[$k]; } $code = $operation == 'DECODE' ? $code : base64_encode($code); return $code; } function set_cookie($var, $value = '', $time = 0) { $time = $time > 0 ? $time : 0; $s = $_SERVER['SERVER_PORT'] == '443' ? 1 : 0; $var = C('COOKIE_PRE').$var; $_COOKIE[$var] = $value; if(is_array($value)) { foreach($value as $k=>$v) { setcookie($var.'['.$k.']', $v, $time, C('COOKIE_PATH'), C('COOKIE_DOMAIN'), $s); } } else { setcookie($var, $value, $time, C('COOKIE_PATH'), C('COOKIE_DOMAIN'), $s); } } function get_cookie($var) { $var = C('COOKIE_PRE').$var; return isset($_COOKIE[$var]) ? $_COOKIE[$var] : false; } function escape($str) { if(strtolower(C('DEFAULT_CHARSET'))=='gbk') { preg_match_all("/[\x80-\xff].|[\x01-\x7f]+/",$str,$r); $ar = $r[0]; foreach($ar as $k=>$v) { if(ord($v[0]) < 128) $ar[$k] = rawurlencode($v); else $ar[$k] = "%u".bin2hex(iconv(CHARSET,"UCS-2",$v)); } return join("",$ar); } else { preg_match_all("/[\xc2-\xdf][\x80-\xbf]+|[\xe0-\xef][\x80-\xbf]{2}|[\xf0-\xff][\x80-\xbf]{3}|[\x01-\x7f]+/e",$str,$r); $str = $r[0]; $len = count($str); for($i=0; $i<$len; $i++) { $value = ord($str[$i][0]); if($value < 223){ $str[$i] = rawurlencode(utf8_decode($str[$i])); } else { $str[$i] = "%u".strtoupper(bin2hex(iconv("UTF-8","UCS-2",$str[$i]))); } } return join("",$str); } } function userurl($arr){ if(empty($arr)) return ''; foreach($arr as $k=>$v){ $arr[$k]['url_pro']='View/user/uid/'.$v['uid'].C('URL_HTML_SUFFIX'); } return $arr; } function mod_name($mod){ $arr= array( 'Index'=>'首页', 'Search'=>'搜索会员', 'Diary'=>'会员日记', 'Help'=>'使用帮助', 'Member'=>'会员中心', 'Pay'=>'财务管理', 'Collect'=>'收藏会员', 'Album'=>'个人相片', 'Message'=>'站内短信', 'Register'=>'注册会员' ); if($arr[$mod]){ return $arr[$mod]; }else{ return ''; } } function filterReplace($str) { $filterWords = unserialize(substr(file_get_contents(LIB_PATH."/Cache/filter_inc.php"),13)); for($i=0;$i<count($filterWords);$i++) { $str = str_ireplace($filterWords[$i][0],$filterWords[$i][1],$str); } unset($filterWords); return $str; } function cache_read($file, $path = '', $iscachevar = 0) { if(!$path) $path = CACHE_PATH; $cachefile = $path.$file; if($iscachevar) { global $TEMP; $key = 'cache_'.substr($file, 0, -4); return isset($TEMP[$key]) ? $TEMP[$key] : $TEMP[$key] = @include $cachefile; } return @include $cachefile; } function cache_write($file, $array, $path = '') { if(!is_array($array)) return false; $array = "<?php\nreturn ".var_export($array, true).";\n?>"; $cachefile = ($path ? $path : TEMP_PATH).$file; $strlen = file_put_contents($cachefile, $array); @chmod($cachefile, 0777); return $strlen; } function cache_delete($file, $path = '') { $cachefile = ($path ? $path : CACHE_PATH).$file; return @unlink($cachefile); } function fomattime($date){ $year=split("-",$date); return $b=mktime(0,0,0,$year['1'],$year['2'],$year['0']); } function bir2age($date){ $now=time(); $bir=fomattime($date); $age=($now-$bir)/(3600*24*365); return intval($age); } function get_cityid($name){ $name=str_replace('市', '', $name); $AREA=require COMMON_PATH.'/Area/area.php'; foreach($AREA as $k=>$v){ if($name==$v['name']){ $cid=$v['areaid']; break; } } if($cid){ return $cid; }else{ return '0'; } } function dec1($n){ return $n-1; } function getadsurl($str,$charset="utf-8"){ return '<script type="text/javascript" src="'.__PUBLIC__.'/ads/'.$str.'.js" charset="'.$charset.'"></script>'; } return array ( 'app_debug' => false, 'app_domain_deploy' => false, 'app_plugin_on' => false, 'app_file_case' => false, 'app_group_depr' => '.', 'app_group_list' => '', 'app_autoload_reg' => false, 'app_autoload_path' => 'Think.Util.', 'app_config_list' => array ( 0 => 'taglibs', 1 => 'routes', 2 => 'tags', 3 => 'htmls', 4 => 'modules', 5 => 'actions', ), 'cookie_expire' => 3600, 'cookie_domain' => '', 'cookie_path' => '/', 'cookie_prefix' => '', 'default_app' => '@', 'default_group' => 'Home', 'default_module' => 'Index', 'default_action' => 'index', 'default_charset' => 'utf-8', 'default_timezone' => 'PRC', 'default_ajax_return' => 'JSON', 'default_theme' => 'default', 'default_lang' => 'zh-cn', 'db_type' => 'mysql', 'db_host' => 'localhost', 'db_name' => 'fsfriend', 'db_user' => 'root', 'db_pwd' => '', 'db_port' => 3306, 'db_prefix' => 'fs_', 'db_suffix' => '', 'db_fieldtype_check' => false, 'db_fields_cache' => true, 'db_charset' => 'utf8', 'db_deploy_type' => 0, 'db_rw_separate' => false, 'data_cache_time' => '600', 'data_cache_compress' => false, 'data_cache_check' => false, 'data_cache_type' => 'File', 'data_cache_path' => './Runtime/Temp/', 'data_cache_subdir' => false, 'data_path_level' => 1, 'error_message' => '您浏览的页面暂时发生了错误！请稍后再试～', 'error_page' => '', 'html_cache_on' => false, 'html_cache_time' => 60, 'html_read_type' => 0, 'html_file_suffix' => '.shtml', 'lang_switch_on' => false, 'lang_auto_detect' => true, 'log_record' => false, 'log_file_size' => 2097152, 'log_record_level' => array ( 0 => 'EMERG', 1 => 'ALERT', 2 => 'CRIT', 3 => 'ERR', ), 'page_rollpage' => 5, 'page_listrows' => 20, 'session_auto_start' => true, 'show_run_time' => false, 'show_adv_time' => true, 'show_db_times' => true, 'show_cache_times' => true, 'show_use_mem' => true, 'show_page_trace' => false, 'show_error_msg' => true, 'tmpl_engine_type' => 'Think', 'tmpl_detect_theme' => false, 'tmpl_template_suffix' => '.html', 'tmpl_cachfile_suffix' => '.php', 'tmpl_deny_func_list' => 'echo,exit', 'tmpl_parse_string' => '', 'tmpl_l_delim' => '{', 'tmpl_r_delim' => '}', 'tmpl_var_identify' => 'array', 'tmpl_strip_space' => false, 'tmpl_cache_on' => false, 'tmpl_cache_time' => -1, 'tmpl_action_error' => 'Public:success', 'tmpl_action_success' => 'Public:success', 'tmpl_trace_file' => './ThinkPHP/Tpl/PageTrace.tpl.php', 'tmpl_exception_file' => './ThinkPHP/Tpl/ThinkException.tpl.php', 'tmpl_file_depr' => '/', 'taglib_begin' => '<', 'taglib_end' => '>', 'taglib_load' => true, 'taglib_build_in' => 'cx', 'taglib_pre_load' => '', 'tag_nested_level' => 3, 'tag_extend_parse' => '', 'token_on' => false, 'token_name' => '__hash__', 'token_type' => 'md5', 'url_case_insensitive' => false, 'url_router_on' => false, 'url_dispatch_on' => true, 'url_model' => 3, 'url_pathinfo_model' => 2, 'url_pathinfo_depr' => '/', 'url_html_suffix' => '.html', 'var_group' => 'g', 'var_module' => 'm', 'var_action' => 'a', 'var_router' => 'r', 'var_page' => 'p', 'var_template' => 't', 'var_language' => 'l', 'var_ajax_submit' => 'ajax', 'var_pathinfo' => 's', 'site_name' => '友情网', 'site_url' => 'http://localhost/friend/', 'site_title' => '同城交友,网络交友', 'site_keywords' => '同城交友,网络交友,免费交友', 'site_description' => '友情网一个优秀的同城网络交友平台，欢迎使用', 'site_copyright' => 'Copyright  © 2020 ', 'site_icp' => '沪ICP备', 'site_stats' => '<script language="javascript" type="text/javascript" src="http://js.users.51.la/4277084.js"></script>
<noscript><a href="http://www.51.la/?4277084" target="_blank"><img alt="我要啦免费统计" src="http://img.users.51.la/4277084.asp" style="border:none" /></a></noscript>', 'site_email' => 'admin@163.com', 'safe_code' => 'abcd', 'site_path' => '/', 'email' => array ( 'SMTP_HOST' => 'smtp.qq.com', 'SMTP_PORT' => '25', 'SMTP_USERNAME' => 'admin@foxmail.com', 'SMTP_PASSWORD' => '123456', 'SMTP_FROM_TO' => 'admin@163.com', 'SMTP_FROM_NAME' => '友情网交友', ), 'reg_audit' => '0', 'user_auth_on' => true, 'user_auth_type' => 1, 'user_auth_key' => 'authId', 'admin_auth_key' => 'administrator', 'user_auth_model' => 'Member', 'auth_pwd_encoder' => 'md5', 'user_auth_gateway' => '/Admin/login', 'not_auth_module' => '', 'require_auth_module' => 'Admin,AdminSys,AdminMod,AdminMem', 'not_auth_action' => 'amlo,verify,check', 'require_auth_action' => '', 'not_login_action' => 'login,checklogin,photo,user,diary,article,ajax', 'not_login_module' => 'index,help,register,search,diary', 'guest_auth_on' => true, 'guest_auth_id' => 0, 'db_like_fields' => 'title|remark', 'rbac_role_table' => 'think_role', 'rbac_user_table' => 'think_role_user', 'rbac_access_table' => 'think_access', 'rbac_node_table' => 'think_node', 'auth_key' => 'QtAdrUcAaoMHvYMKTzDq', 'cookie_pre' => 'HaGBidPbnC', 'xgcms_version' => 'V2.1 Release 20130522 ', 'love_version' => '2.1', 'buy_type' => '未授权', 'buy_time' => '', 'buy_key' => '未授权', 'buy_domain' => '', '_htmls_' => array ( 'base' => array ( 0 => 'search/{city}/{$_SERVER.REQUEST_URI|md5}', 1 => '3600', ), ), ); ?>